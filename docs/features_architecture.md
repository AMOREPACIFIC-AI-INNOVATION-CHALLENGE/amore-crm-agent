# **AI Agent 기능 및 구조**
<br>

# 1. 주요 기능 목록

본 시스템은 고객을 특정 페르소나로 분류한 뒤, 해당 페르소나에 부합하는 제품만을 후보로 제한한다. 제한된 제품 중 행동, 컨텍스트, 비즈니스 점수를 기반으로 최적의 제품 1종을 선정한 후, 브랜드 톤을 반영한 메시지 3종을 생성, 검수, 기록하는 마케팅 AI 큐레이터이다. 자세한 기능은 다음과 같다.

## 1. 고객 페르소나 분석

### 1) 고객 페르소나 분류

- 마케터가 더미 고객 리스트에서 1명을 선택하면, 고객 기본 프로필(성별/나이/피부타입/피부고민/피부톤)과 최근 행동 로그(검색어/최근 본 상품/체류시간/장바구니/구매이력), 날씨/시즌/기념일 등 마케팅 컨텍스트를 불러온다.
- LLM이 고객 데이터를 분석해 6가지 페르소나 중 단 1개로 분류한다.

### 2) 근거 설명 메시지 생성

- 마케터가 이해할 수 있도록 분류 근거 설명 메시지를 생성한다.

## 2. 추천 상품 선정

### 1) 페르소나 하드 필터 기반 제품 후보 검색 (Vector DB)

- Vector DB의 메타데이터 필터링(Hard Filter)을 통해 페르소나에 매핑된 제품군으로 검색 범위를 제한한 후, 고객 데이터 기반 쿼리로 벡터 유사도 검색을 수행하여 Top-K를 추출한다

### 2) 최적 제품 1종 선정

- 후보군 Top-K에 대해 고객 정보 및 로그와 마케팅 컨텍스트를 종합적으로 고려해 최적의 제품 1종을 선정한다.

## 3. 마케팅 메시지 생성

### 1) RAG 기반 제품 정보 수집 + 브랜드 톤 설정 + 프롬프트 설계

- 최종 선정된 제품 1종에 대해 RAG로 성분, 효능, 기술력, 리뷰 요약 등 근거 정보를 추출한다.
- 브랜드 DB에서 해당 브랜드의 톤앤매너, 금기어, 권장 표현을 로드한다.
- 캠페인 목적과 제약조건, 이전 결과값인 제품 추천 사유를 반영해 프롬프트를 설계한다.

### 2) 메시지 생성 (전략이 다른 3종 후보)

- 동일한 제품, 근거, 브랜드 톤을 사용하되 전략이 다른 3가지 메시지 후보를 생성한다.
    - 1안) 효능/기술 강조형
    - 2안) 사용 상황 공감형
    - 3안) 혜택/실용 정보형

## 4. 제약조건 검수 및 최종 메시지 출력

### 1) 제약조건 검수 및 재생성 루프

- 글자 수 제한, 브랜드 톤앤매너 적합성을 고려하여 검수한다.
- 실패 시, 구체적인 수정 지시를 생성하여 메시지 생성 단계로 재요청한다.
- 이때 재요청 횟수는 최대 5회까지 가능하며 5회 실패 시엔 마케터에게 수동 수정을 요청한다. (무한 루프 방지)

### 2) 최종 메시지 출력

- 시스템은 기본적으로 최적의 메시지 1안을 제공하되, 주기적으로 마케터 선호도 탐색 목적의 3안까지 출력한다.

## 5. 개선을 위한 데이터 학습

### 1) 마케터 선택 로그 저장

- 메시지 후보를 3안까지 출력한 경우, 마케터가 1개를 선택하면 선택 로그로 저장하여 향후 개선에 활용한다.

<br>

# 2. 기능 간 관계

본 시스템은 [분석 → 검색 → 최적화 → 생성 → 검증 → 학습]의 순차적 파이프라인으로 작동하며 각 단계는 하위 모듈에 제약조건과 컨텍스트를 전달하는 결합 관계를 가집니다.

### 1. 고객 페르소나 분석

- 결정된 페르소나는 [제품 선정] 단계에서 전체 상품을 다 살펴보는 것이 아닌 해당 페르소나에 매핑된 제품만 살펴보는데 사용되는 필수 키가 된다.
- 분석된 페르소나의 특성은 [메시지 생성] 단계에서 사용자에게 맞는 공감메시지/말투/표현을 만들기 위한 바탕으로 활용된다.

### 2. 추천 상품 선정

- top-k 후보군 중 하나를 선택하여 [메시지 생성] 단계로 전달한다.
- 상품 선정 후 생성된 ‘추천 이유’를 [메시지 생성] 시 프롬프트 내에 주입하여 메시지의 설득력을 높인다.

### 3. 마케팅 메시지 생성

- RAG를 통해 참조한 제품의 성분, 효능 데이터는 [제약조건 검수] 단계에서 생성된 메시지의 허위/과장 여부를 판별하는 진위 검증 데이터로 활용된다.
- 최종 선정된 제품에 대해 생성된 서로 다른 3가지 메시지는 [검수 및 출력] 단계에서 마케터에게 선택지로 제공된다.

### 4. 제약조건 검수 및 출력

- 생성 모듈의 결과물이 글자 수 제한, 브랜드 톤앤매너 적합성을 통과하지 못할 경우, 이를 [메시지 생성] 단계로 되돌려 보낸다.
- 주기적인 선호도 탐색 단계에서 3가지 메시지 후보가 제안되었을 때, 마케터가 최종 선택한 결과만을 로그로 저장하고 이를 [개선을 위한 데이터 학습] 단계로 전달한다.

### 5. 개선을 위한 데이터 학습

- 마케터가 최종 선택한 메시지는 시스템 성능을 판단하는 기준이 된다. 이 데이터는 [페르소나 분석] 단계의 분류 정확도와 [메시지 생성] 단계의 전략별 가중치를 조정하는 지표로 활용되어 시스템 성능을 지속적으로 향상시키는 선순환 구조를 형성한다.

<br>

# 3. 전체 처리 흐름과 구조

## **1. Architecture Diagram**

### 1단계: 고객 데이터 파악 및 페르소나 분류

- 입력: 고객 데이터(프로필, 행동 로그), 마케팅 컨텍스트(날씨, 계절, 기념일)
- 과정: LLM이 데이터를 종합 분석하여 고객을 6가지 핵심 페르소나 중 하나로 분류한다. 이때 단순 분류를 넘어 "왜 이 페르소나인가?"에 대한 논리적 근거를 생성한 뒤 전역 상태에 저장하여 다음 단계의 검색 쿼리 생성을 위한 기초 데이터로 활용한다.
- 결과물: 페르소나, 분류 근거

### 2단계: Top-K 제품 선정 및 브랜드 톤앤매너 추출

- 과정: 페르소나와 니즈를 기반으로 쿼리 변환(Vector/SQL) 과정을 거쳐 두 가지 채널에서 정보를 병렬 수집한다.
    - Vector Search: 고객의 추상적 니즈를 벡터로 변환, 유사도 검색을 통해 니즈에 부합하는 제품 후보군(Top-K)을 벡터 DB에서 추출한다.
    - SQL Query: 제품의 브랜드 ID 등을 키값으로 SQL을 생성하여 해당 브랜드의 톤앤매너 규칙과 가이드라인을 RDB 정형 데이터로 로드한다.
- 결과물: Top-K 제품 후보들, 브랜드 톤앤매너

### 3단계: 최종 제품 1개 선정

- 과정: 고객 니즈 우선 + 계절감 반영 로직을 수행하는 최적 제품 선정 에이전트가 작동한다.
    - 고객 데이터에 높은 가중치를 두어 Top-K 후보군 중 최종 제품을 1개 선정한다.
- 결과물: 최종 선정된 제품 1개, 추천 사유

### 4단계: 메시지 생성 및 검수

- 과정:
    - 메시지 생성: 선정된 제품의 USP(Unique Selling Point), 브랜드 톤앤매너, 그리고 앞 단계에서 도출된 추천 사유를 종합 프롬프트로 구성하여 마케팅 메시지 초안을 생성한다.
    - 제약 조건 검수: 생성된 메시지가 글자 수 제한, 브랜드 톤앤매너를 준수했는지 검사한다.
    - 검수 통과 실패 시, 에러 피드백을 반영하여 에이전트가 재생성한다.
- 결과물: 마케터가 즉시 사용 가능한 마케팅 메시지